(function(h,c){function k(a,d){c(a).each(function(){var b=c(this),a=b.closest(d).find(".types-suggest").attr("id");g(b.val(),a)})}function g(a,d){var b=a+d;if(typeof g.selected=="undefined")g.selected=[];if(c.inArray(b,g.selected)==-1)return g.selected.push(b),!1;return!0}h.wpcfAccess=h.wpcfAccess||{};var i=h.wpcfAccess;c.typesSuggest=function(a,d,b,e,g,i){function h(a){a?(b.css("visibility","visible"),d.find(".toggle").show()):setTimeout(function(){b.is(":focus")||(b.css("visibility","hidden"),d.find(".toggle").hide())},
100)}function n(a){a.length<2||(a={action:f,q:a},j&&j.abort(),e.show(),j=c.ajax({type:"POST",url:ajaxurl,data:a,dataType:"json",success:function(a){j=null;e.hide();b.empty();var c=0,d="",f;for(f in a)c++,d=d+'<option value="'+f+'">'+a[f]+"</option>";c>0?(a=c,c>5&&(a=5),b.append(d).attr("size",a).css("visibility","visible").find("option:first-child").attr("selected","selected")):b.css("visibility","hidden")}}))}function q(){b.on("change",function(){var a=c(this).find(":selected");o(a.val(),a.text(),
d)});b.on("keydown",function(a){if(a.keyCode==13){var b=c(this).find(":selected");o(b.val(),b.text(),d);a.preventDefault()}})}var f=g,o=i,p=a.val().length,j=null;(function(){var c,d;a.keyup(function(f){f.preventDefault&&f.preventDefault();f.stopPropagation&&f.stopPropagation();f.cancelBubble=!0;f.returnValue=!1;d=a.val();if(13==f.keyCode)return n(d),!1;if(f.keyCode==40&&b.length)b.focus();else if((f.keyCode>=32&&f.keyCode<=127||f.keyCode==8)&&p!=d.length)p=d.length,c&&clearTimeout(c),c=setTimeout(function(){n(a.val())},
500)}).attr("autocomplete","off");q();a.focus(function(){h(!0)}).blur(function(){h(!1)})})()};c.fn.typesSuggest=function(a,d){this.each(function(){var b=c(this),e=b.find(".dropdown"),g=b.find(".img-waiting");b.find(".input").each(function(){new c.typesSuggest(c(this),b,e,g,a,d)})})};c(document).ready(function(){k('.wpcf-access-user-list input[type="hidden"]',"td");c(".types-suggest-user").typesSuggest("wpcf_access_suggest_user",i.Suggest);c(".types-suggest").find(".confirm").click(function(){var a=
c(this).parents(".types-suggest"),d=a.parents("td").find(".wpcf-access-name-holder").val()+"[users][]",b=a.find(".dropdown :selected"),e=b.val(),b=b.text();a.find(".dropdown").css("visibility","hidden");a.find(".toggle").hide();if(typeof e=="undefined")return!1;if(g(e,a.attr("id")))return!1;d='<div class="wpcf-access-remove-user-wrapper"><a href="javascript:void(0);" class="wpcf-access-remove-user">&nbsp;</a><input type="hidden" name="'+d+'" value="'+e+'" />'+b+"</div>";a.parent().find(".wpcf-access-user-list").append(d);
i.DependencyAddUser(c(this),d)});c(".types-suggest").find(".cancel").click(function(){var a=c(this).parents(".types-suggest");a.find(".dropdown").css("visibility","hidden");a.find(".toggle").hide()});c("#wpcf_access_admin_form").on("click",".wpcf-access-remove-user",function(){i.DependencyRemoveUser(c(this));c(this).parent().fadeOut(function(){c(this).remove()})})});i.Suggest=function(){};i.DependencyAddUser=function(a,d){var b=a.parents("table"),e=a.parents("td").find(".wpcf-access-name-holder").data("wpcfaccesscap"),
g=[];typeof h["wpcf_access_dep_true_"+e]!="undefined"&&c.each(h["wpcf_access_dep_true_"+e],function(a,e){b.find('.wpcf-access-name-holder[data-wpcfaccesscap="'+e+'"]').each(function(){var a=c(this).parents("td"),b=a.find(".wpcf-access-name-holder"),f=b.data("wpcfaccesscap"),a=a.find(".wpcf-access-user-list"),e=c(d).find("input").attr("value"),h=c(d),b=b.val(),e=a.find('input[value="'+e+'"]');h.find("input").attr("name",b+"[users][]");e.length<1&&(g.push(f),a.append(h))})});i.DependencyMessageShow(a,
e,g,!0)};i.DependencyRemoveUser=function(a){var d=a.parents("table"),b=a.parent().find("input").val(),e=a.parents("td"),l=e.find(".wpcf-access-name-holder").data("wpcfaccesscap"),m=[],k=e.find(".types-suggest");typeof h["wpcf_access_dep_false_"+l]!="undefined"&&c.each(h["wpcf_access_dep_false_"+l],function(a,e){d.find('.wpcf-access-name-holder[data-wpcfaccesscap="'+e+'"]').each(function(){var a=c(this).parents("td").find(".wpcf-access-remove-user-wrapper").find('input[value="'+b+'"]');a.length>0&&
(m.push(e),a.parent().remove());a=k.attr("id");a=b+a;if(typeof g.selected=="undefined")g.selected=[];a=c.inArray(a,g.selected);a!=-1&&g.selected.splice(a)})});i.DependencyMessageShow(a,l,m,!1)}})(window,jQuery);
